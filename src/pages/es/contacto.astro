---
/**
 * P√°gina de Contacto - Dise√±o Minimalista
 */

import Layout from '@/layouts/Layout.astro';
import { CONTACT_INFO } from '@/lib/constants';
import translations from '../../../public/locales/es/contact.json';
import FAQs from '@components/faq/FAQs.astro';
import FAQSchema from '@components/faq/FAQSchema.astro';
import { faqsContacto } from '@data/faqs';

const t = translations;
---

<Layout
  title={t.meta.title}
  description={t.meta.description}
>
  <!-- Hero Section (Estilo Netflix) -->
  <section class="relative overflow-hidden bg-black py-28 text-white">
    <div class="pointer-events-none absolute inset-0">
      <div class="absolute -top-40 left-1/2 h-[600px] w-[600px] -translate-x-1/2 rounded-full bg-red-600/20 blur-3xl"></div>
      <div class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-black to-transparent"></div>
    </div>
    <div class="container relative">
      <div class="mx-auto max-w-3xl text-center">
        <h1 class="mb-5 bg-gradient-to-b from-white to-white/70 bg-clip-text text-5xl font-black uppercase tracking-tighter text-transparent md:text-7xl">
          {t.hero.title}
        </h1>
        <p class="mx-auto mb-10 max-w-2xl text-lg text-gray-300 md:text-xl">
          {t.hero.subtitle}
        </p>

        <div class="flex flex-col items-center justify-center gap-4 sm:flex-row sm:gap-6">
          <a href={`tel:${CONTACT_INFO.phone}`} class="inline-flex items-center justify-center rounded-lg bg-red-600 px-8 py-4 text-sm font-bold uppercase tracking-wider text-white transition-all hover:bg-red-700 hover:shadow-lg hover:shadow-red-600/30">
            {t.cta.button}
          </a>
          <a href={`https://wa.me/34673975252`} target="_blank" rel="noopener" class="inline-flex items-center justify-center rounded-lg border-2 border-white/20 bg-white/5 px-8 py-4 text-sm font-bold uppercase tracking-wider text-white transition-all hover:border-red-600 hover:bg-red-600/10">
            WhatsApp
          </a>
        </div>

        <div class="mt-8 text-sm text-gray-400">
          <span class="mr-4">{CONTACT_INFO.phone}</span>
          <span class="opacity-50">‚Ä¢</span>
          <span class="ml-4">{CONTACT_INFO.email}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Formulario Glass + Tarjetas de contacto (Oscuro) -->
  <section class="relative z-10 -mt-10 bg-gradient-to-b from-black via-black to-gray-950 py-20">
    <div class="container">
      <div class="grid gap-10 lg:grid-cols-5">
        <!-- Panel Glass del Formulario -->
        <div class="lg:col-span-3">
          <div class="rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-xl md:p-10">
            <h2 class="mb-6 text-2xl font-black uppercase tracking-tight text-white md:text-3xl">{t.form.title}</h2>
            <form id="contactForm" class="space-y-5">
              <div>
                <label for="name" class="mb-2 block text-xs font-bold uppercase tracking-wider text-white/70">{t.form.name}</label>
                <input type="text" id="name" name="name" required class="w-full rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-white/40 outline-none transition-colors focus:border-red-600" placeholder={t.form.name_placeholder} />
              </div>
              <div class="grid gap-5 sm:grid-cols-2">
                <div>
                  <label for="email" class="mb-2 block text-xs font-bold uppercase tracking-wider text-white/70">{t.form.email}</label>
                  <input type="email" id="email" name="email" required class="w-full rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-white/40 outline-none transition-colors focus:border-red-600" placeholder={t.form.email_placeholder} />
                </div>
                <div>
                  <label for="phone" class="mb-2 block text-xs font-bold uppercase tracking-wider text-white/70">{t.form.phone}</label>
                  <input type="tel" id="phone" name="phone" class="w-full rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-white/40 outline-none transition-colors focus:border-red-600" placeholder={t.form.phone_placeholder} />
                </div>
              </div>
              <!-- Casilla de aceptaci√≥n SMS (obligatoria) -->
              <div class="flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3">
                <input
                  type="checkbox"
                  id="sms_consent"
                  name="sms_consent"
                  required
                  class="mt-1 h-4 w-4 rounded border-white/40 bg-transparent text-red-600"
                />
                <label for="sms_consent" class="text-xs text-white/80">
                  Acepto recibir comunicaciones por SMS relacionadas con los servicios de Scorus Fitness y confirmo que el n√∫mero de tel√©fono indicado es correcto.
                </label>
              </div>
              <div>
                <label for="service" class="mb-2 block text-xs font-bold uppercase tracking-wider text-white/70">{t.form.service}</label>
                <select id="service" name="service" class="w-full rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-white outline-none transition-colors focus:border-red-600">
                  <option value="" class="text-black">{t.form.service_placeholder}</option>
                  <option value="entrenamiento-personal" class="text-black">{t.form.service_personal}</option>
                  <option value="consultoria-online" class="text-black">{t.form.service_online}</option>
                  <option value="gym" class="text-black">{t.form.service_gym}</option>
                  <option value="scorus-campus" class="text-black">{t.form.service_campus}</option>
                  <option value="re-born" class="text-black">{t.form.service_reborn}</option>
                  <option value="otro" class="text-black">{t.form.service_other}</option>
                </select>
              </div>
              <div>
                <label for="message" class="mb-2 block text-xs font-bold uppercase tracking-wider text-white/70">{t.form.message}</label>
                <textarea id="message" name="message" rows="6" required class="w-full rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-white/40 outline-none transition-colors focus:border-red-600" placeholder={t.form.message_placeholder}></textarea>
              </div>
              <button type="submit" class="group inline-flex w-full items-center justify-center rounded-lg bg-red-600 px-8 py-4 text-sm font-bold uppercase tracking-wider text-white transition-all hover:bg-red-700 hover:shadow-lg hover:shadow-red-600/30">
                {t.form.submit}
              </button>
            </form>
            <!-- Formulario oculto para enviar datos a Mailchimp usando el mismo endpoint que el embed -->
            <form
              id="mailchimpForm"
              action="https://scorusfitness.us1.list-manage.com/subscribe/post?u=23467b9e68b325f622e292a10&amp;id=29af210041&amp;f_id=0051c7e1f0"
              method="post"
              target="_blank"
              class="hidden"
            >
              <input type="hidden" name="FNAME" id="mc-FNAME" />
              <input type="hidden" name="LNAME" id="mc-LNAME" />
              <input type="hidden" name="EMAIL" id="mc-EMAIL" />
              <!-- Tag "Cliente web oficial SF" -->
              <input type="hidden" name="tags" value="12555" />
            </form>
          </div>
        </div>

        <!-- Tarjetas de Contacto (Glass) -->
        <div class="lg:col-span-2">
          <div class="grid gap-5 sm:grid-cols-2 lg:grid-cols-1">
            <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-white backdrop-blur-xl">
              <p class="mb-2 text-xs font-bold uppercase tracking-wider text-white/60">{t.info.phone}</p>
              <a href={`tel:${CONTACT_INFO.phone}`} class="text-lg font-semibold text-white hover:text-red-400">{CONTACT_INFO.phone}</a>
            </div>
            <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-white backdrop-blur-xl">
              <p class="mb-2 text-xs font-bold uppercase tracking-wider text-white/60">{t.info.email}</p>
              <a href={`mailto:${CONTACT_INFO.email}`} class="break-all text-lg font-semibold text-white hover:text-red-400">{CONTACT_INFO.email}</a>
            </div>
            <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-white backdrop-blur-xl">
              <p class="mb-2 text-xs font-bold uppercase tracking-wider text-white/60">{t.info.address}</p>
              <p class="text-white/90">{CONTACT_INFO.address}</p>
            </div>
            <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-white backdrop-blur-xl">
              <p class="mb-2 text-xs font-bold uppercase tracking-wider text-white/60">{t.info.schedule}</p>
              <p class="text-white/90">{t.info.schedule_value}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-black py-32 text-white">
    <div class="container">
      <div class="mx-auto max-w-3xl text-center">
        <h2 class="mb-8 text-5xl font-bold md:text-6xl">{t.cta.title}</h2>
        <p class="mb-8 text-lg text-gray-400">{t.cta.description}</p>
        <a
          href={`tel:${CONTACT_INFO.phone}`}
          class="inline-flex items-center justify-center border-2 border-white bg-white px-12 py-5 text-lg font-semibold text-black transition-all hover:bg-transparent hover:text-white"
        >
          {t.cta.button}
        </a>
      </div>
    </div>
  </section>

  <!-- FAQs Section -->
  <FAQs 
    faqs={faqsContacto}
    title="Preguntas sobre Contacto"
    subtitle="Informaci√≥n √∫til sobre c√≥mo ponerte en contacto con nosotros"
  />

  <!-- FAQPage Schema for SEO -->
  <FAQSchema faqs={faqsContacto} />

</Layout>

<script is:inline define:vars={{ webhookUrl: import.meta.env.PUBLIC_GOOGLE_SHEETS_WEBHOOK_URL }}>
window.addEventListener('DOMContentLoaded', () => {
  const el = document.getElementById('contact-translations');
  let translations = {};
  if (el) {
    try {
      const textContent = el.textContent || '{}';
      translations = JSON.parse(textContent);
    } catch (parseError) {
      console.error('Error al parsear traducciones:', parseError);
      translations = {};
    }
  }
  const formEl = document.getElementById('contactForm');
  formEl?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const button = form.querySelector('button[type="submit"]');
    const originalText = button?.textContent;
    try {
      if (button) {
        button.disabled = true;
        button.textContent = `${translations.form?.sending || 'Enviando...'}`;
      }
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);
      
      // Detectar el idioma de la p√°gina actual
      const currentPath = window.location.pathname;
      let language = 'es';
      if (currentPath.startsWith('/en/')) language = 'en';
      else if (currentPath.startsWith('/de/')) language = 'de';
      else if (currentPath.startsWith('/fr/')) language = 'fr';
      else if (currentPath.startsWith('/hu/')) language = 'hu';
      
      // Enviar datos a Google Sheets si est√° configurado
      if (webhookUrl) {
        try {
          await fetch(webhookUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              name: data.name,
              email: data.email,
              phone: data.phone || '',
              service: data.service || '',
              message: data.message,
              language: language
            })
          });
        } catch (sheetsError) {
          console.warn('Error al enviar a Google Sheets:', sheetsError);
          // Continuar aunque falle Google Sheets
        }
      }
      
      // Enviar datos a Mailchimp usando el mismo endpoint que el formulario embed
      try {
        const mcForm = document.getElementById('mailchimpForm');
        if (mcForm) {
          const nameValue = (data.name || '').toString().trim();
          const [firstName, ...restName] = nameValue.split(' ');
          const lastName = restName.join(' ');
          
          const mcFName = mcForm.querySelector('#mc-FNAME');
          const mcLName = mcForm.querySelector('#mc-LNAME');
          const mcEmail = mcForm.querySelector('#mc-EMAIL');

          if (mcFName) mcFName.value = firstName || '';
          if (mcLName) mcLName.value = lastName || '';
          if (mcEmail) mcEmail.value = (data.email || '').toString();

          // Enviar el formulario oculto a Mailchimp
          mcForm.submit();
        }
      } catch (mailchimpError) {
        console.error('Error al enviar a Mailchimp (form embed):', mailchimpError);
        // Continuar aunque falle Mailchimp
      }
      
      // Enviar a WhatsApp solo despu√©s de que todo se haya enviado correctamente
      // (Comentado - descomenta si quieres que se abra autom√°ticamente)
      // const message = `\n*Nueva solicitud de contacto*\n\n\nüìù *Nombre:* ${data.name}\n\nüìß *Email:* ${data.email}\n\nüì± *Tel√©fono:* ${data.phone || 'No proporcionado'}\n\nüéØ *Servicio:* ${data.service || 'No especificado'}\n\n\nüí¨ *Mensaje:*\n${data.message}`.trim();
      // const whatsappLink = `https://wa.me/34673975252?text=${encodeURIComponent(message)}`;
      // window.open(whatsappLink, '_blank');
      
      if (button) {
        button.textContent = `${translations.form?.success || 'Enviado'}`;
        button.classList.add('!bg-green-600', 'hover:!bg-green-700');
      }
      form.reset();
      setTimeout(() => {
        if (button) {
          button.textContent = originalText || `${translations.form?.submit || 'Enviar'}`;
          button.classList.remove('!bg-green-600', 'hover:!bg-green-700');
          button.disabled = false;
        }
      }, 3000);
    } catch (error) {
      console.error('Error:', error);
      if (button) {
        button.textContent = `${translations.form?.error || 'Error'}`;
        button.classList.add('!bg-red-800');
      }
      setTimeout(() => {
        if (button) {
          button.textContent = originalText || `${translations.form?.submit || 'Enviar'}`;
          button.classList.remove('!bg-red-800');
          button.disabled = false;
        }
      }, 2000);
    }
  });
});
</script>
<script type="application/json" id="contact-translations" set:html={JSON.stringify(t)}></script>
