---
import { convertRoute } from '@utils/routeConverter';

const languages = [
  { code: 'es', name: 'ES', fullName: 'Español' },
  { code: 'en', name: 'EN', fullName: 'English' },
  { code: 'fr', name: 'FR', fullName: 'Français' },
  { code: 'de', name: 'DE', fullName: 'Deutsch' },
  { code: 'hu', name: 'HU', fullName: 'Magyar' },
];

// Detectar idioma desde la URL
const currentPath = Astro.url.pathname;
const pathParts = currentPath.split('/').filter(Boolean);
const potentialLang = pathParts[0];
const currentLang = ['en', 'fr', 'de', 'hu'].includes(potentialLang) ? potentialLang : 'es';

// Generar URLs traducidas para cada idioma
const translatedUrls = languages.reduce((acc, lang) => {
  acc[lang.code] = convertRoute(currentPath, lang.code, currentLang);
  return acc;
}, {} as Record<string, string>);
---

<div class="group relative">
  <button
    type="button"
    class="flex items-center text-sm font-bold uppercase tracking-wider text-current transition-colors hover:text-red-600"
    aria-label="Cambiar idioma"
  >
    {languages.find(lang => lang.code === currentLang)?.name || 'ES'}
    <svg class="ml-1 h-3 w-3 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- Dropdown Menu con acento rojo -->
  <div class="invisible absolute right-0 mt-4 w-48 origin-top-right scale-95 border-t-2 border-red-600 bg-white py-2 opacity-0 shadow-2xl transition-all duration-200 group-hover:visible group-hover:scale-100 group-hover:opacity-100">
    {languages.map((lang) => (
      <a
        href={translatedUrls[lang.code]}
        class:list={[
          'block border-l-4 px-6 py-3 text-sm font-semibold uppercase tracking-wider transition-all',
          currentLang === lang.code
            ? 'border-red-600 bg-black text-white'
            : 'border-transparent text-gray-700 hover:border-red-600 hover:bg-gray-50 hover:text-red-600',
        ]}
      >
        <span class="font-bold">{lang.name}</span>
        <span class="ml-2 text-xs opacity-70">{lang.fullName}</span>
      </a>
    ))}
  </div>
</div>
